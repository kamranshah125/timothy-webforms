<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>{{ $form_name ?? 'Form Submission' }}</title>
    <style>
        @page {
            margin: 15mm 12mm;
            size: letter;
        }

        body {
            font-family: DejaVu Sans, sans-serif;
            font-size: 10pt;
            line-height: 1.5;
            color: #000;
            margin: 0;
            padding: 0;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 3px solid #2c5aa0;
        }

        .company-name {
            font-size: 18pt;
            font-weight: bold;
            color: #2c5aa0;
            margin: 0 0 5px 0;
        }

        .contact-info {
            font-size: 9pt;
            color: #555;
            margin: 2px 0;
        }

        .form-title {
            font-size: 14pt;
            font-weight: bold;
            text-align: center;
            margin: 12px 0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Personal Details Box */
        .personal-box {
            background: #f8f9fa;
            border: 2px solid #2c5aa0;
            padding: 12px;
            margin: 12px 0 20px 0;
        }

        .personal-box h3 {
            margin: 0 0 10px 0;
            font-size: 11pt;
            color: #2c5aa0;
            text-transform: uppercase;
            border-bottom: 1px solid #ccc;
            padding-bottom: 5px;
        }

        .info-grid {
            margin-top: 8px;
        }

        .info-row {
            margin: 5px 0;
            overflow: hidden;
        }

        .info-item {
            display: inline-block;
            width: 48%;
            font-size: 9pt;
            vertical-align: top;
        }

        .info-label {
            font-weight: bold;
            color: #333;
        }

        .info-value {
            color: #000;
        }

        /* Page Headers */
        .page-header {
            background: #2c5aa0;
            color: white;
            padding: 8px 12px;
            margin: 20px 0 12px 0;
            font-size: 11pt;
            font-weight: bold;
            text-transform: uppercase;
        }

        .page-description {
            font-size: 9pt;
            color: #555;
            font-style: italic;
            margin: -8px 0 12px 0;
            padding-left: 5px;
        }

        /* Question Block */
        .question-block {
            margin: 12px 0;
            padding: 10px;
            background: #fafafa;
            border-left: 3px solid #2c5aa0;
            page-break-inside: avoid;
        }

        .question-label {
            font-weight: bold;
            color: #222;
            margin-bottom: 5px;
            font-size: 10pt;
        }

        .required-mark {
            color: #d32f2f;
            font-weight: bold;
        }

        .answer-text {
            color: #000;
            padding: 5px 0 0 15px;
            font-size: 10pt;
        }

        /* Radio Score Table */
        .radio-score-table {
            width: 100%;
            border-collapse: collapse;
            margin: 8px 0;
            font-size: 8.5pt;
        }

        .radio-score-table th {
            background: #2c5aa0;
            color: white;
            padding: 5px 3px;
            text-align: center;
            font-weight: bold;
            border: 1px solid #1e3d6b;
            font-size: 8pt;
        }

        .radio-score-table td {
            border: 1px solid #ddd;
            padding: 5px;
            text-align: center;
        }

        .radio-score-table td:first-child {
            text-align: left;
            background: #f8f9fa;
            font-weight: 500;
            width: 40%;
        }

        .radio-option {
            width: 10%;
        }

        .selected-option {
            background: #2c5aa0 !important;
            color: white;
            font-weight: bold;
        }

        .checkbox-mark {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 2px solid #333;
            margin-right: 5px;
            vertical-align: middle;
        }

        .checkbox-mark.checked {
            background: #2c5aa0;
            border-color: #2c5aa0;
            position: relative;
        }

        .checkbox-mark.checked::after {
            content: "✓";
            color: white;
            font-size: 10pt;
            position: absolute;
            top: -3px;
            left: 1px;
        }

        /* Checkbox Group */
        .checkbox-group {
            padding: 8px 0 0 15px;
        }

        .checkbox-item {
            margin: 5px 0;
            font-size: 9.5pt;
        }

        /* Score Summary */
        .score-summary {
            background: #e8f0f8;
            border: 2px solid #2c5aa0;
            padding: 12px;
            margin: 20px 0;
            page-break-inside: avoid;
        }

        .score-summary h3 {
            margin: 0 0 10px 0;
            color: #2c5aa0;
            font-size: 12pt;
        }

        .score-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 8px;
        }

        .score-table th {
            background: #2c5aa0;
            color: white;
            padding: 6px;
            text-align: left;
            font-weight: bold;
            border: 1px solid #1e3d6b;
        }

        .score-table td {
            padding: 6px;
            border: 1px solid #ddd;
            background: white;
        }

        .score-value {
            text-align: center;
            font-weight: bold;
            font-size: 11pt;
        }

        .total-score-row {
            background: #2c5aa0 !important;
            color: white !important;
            font-weight: bold;
            font-size: 11pt;
        }

        /* Page Break */
        .page-break {
            page-break-after: always;
        }

        .avoid-break {
            page-break-inside: avoid;
        }

        /* Textarea Response */
        .textarea-response {
            background: white;
            border: 1px solid #ddd;
            padding: 8px;
            margin-top: 5px;
            min-height: 30px;
            font-size: 9.5pt;
            white-space: pre-wrap;
        }

        /* Footer */
        .pdf-footer {
            position: fixed;
            bottom: 0;
            width: 100%;
            text-align: center;
            font-size: 8pt;
            color: #666;
            padding-top: 8px;
            border-top: 1px solid #ddd;
        }

        /* Empty Value Styling */
        .empty-value {
            color: #999;
            font-style: italic;
        }
    </style>
</head>
<body>

    {{-- Header --}}
    <div class="header">
        <div class="company-name">NeuroFiT Connections</div>
        <div class="contact-info">117 Edinburgh South Drive, Ste 102 | Cary, NC 27511</div>
        <div class="contact-info">(833) 632-5437 | info@neurofitconnections.com</div>
    </div>

    <div class="form-title">{{ $form_name ?? ucfirst($form_type) }}</div>

    {{-- Personal Details Summary --}}
    @php
        $page1 = $form['page1'] ?? [];
        $isChild = ($page1['is_child'] ?? 'no') === 'yes';
    @endphp

    <div class="personal-box avoid-break">
        <h3>{{ $isChild ? 'Child' : 'Personal' }} Information</h3>
        <div class="info-grid">
            <div class="info-row">
                <div class="info-item">
                    <span class="info-label">Full Name:</span>
                    <span class="info-value">{{ $page1['full_name'] ?? 'N/A' }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Date of Birth:</span>
                    <span class="info-value">{{ $page1['dob'] ?? 'N/A' }}</span>
                </div>
            </div>
            <div class="info-row">
                <div class="info-item">
                    <span class="info-label">Email:</span>
                    <span class="info-value">{{ $page1['email'] ?? $user->email ?? 'N/A' }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Phone:</span>
                    <span class="info-value">{{ $page1['phone'] ?? 'N/A' }}</span>
                </div>
            </div>
            @if(!empty($page1['preferred_name']))
            <div class="info-row">
                <div class="info-item">
                    <span class="info-label">Preferred Name:</span>
                    <span class="info-value">{{ $page1['preferred_name'] }}</span>
                </div>
            </div>
            @endif
            @if(!empty($page1['address']))
            <div class="info-row">
                <div class="info-item" style="width: 100%;">
                    <span class="info-label">Address:</span>
                    <span class="info-value">{{ $page1['address'] }}</span>
                </div>
            </div>
            @endif
            <div class="info-row" style="margin-top: 8px;">
                <div class="info-item">
                    <span class="info-label">Submitted:</span>
                    <span class="info-value">{{ $submitted_at->format('F j, Y g:i A') }}</span>
                </div>
            </div>
        </div>
    </div>

    {{-- Dynamic Pages from Config --}}
    @php
        $config = config("forms.{$form_type}");
        $pages = $config['pages'] ?? [];
    @endphp

    @foreach($pages as $pageKey => $pageConfig)
        @if($pageKey === 'page1') @continue @endif {{-- Skip page1, already shown above --}}
        
        @php
            $pageData = $form[$pageKey] ?? [];
            $fields = $pageConfig['fields'] ?? [];
        @endphp

        @if(!empty($fields))
            {{-- Page Break before each new section (except first) --}}
            @if($loop->index > 1)
                <div class="page-break"></div>
            @endif

            {{-- Page Header --}}
            <div class="page-header">{{ $pageConfig['title'] ?? ucfirst($pageKey) }}</div>
            
            @if(!empty($pageConfig['description']))
                <div class="page-description">{{ $pageConfig['description'] }}</div>
            @endif

            {{-- Loop through fields --}}
            @foreach($fields as $field)
                @php
                    $fieldName = $field['name'] ?? '';
                    $fieldLabel = $field['label'] ?? ucfirst(str_replace('_', ' ', $fieldName));
                    $fieldType = $field['type'] ?? 'text';
                    $fieldValue = $pageData[$fieldName] ?? null;
                    $required = !empty($field['required']);
                @endphp

                <div class="question-block avoid-break">
                    <div class="question-label">
                        {{ $fieldLabel }}
                        @if($required)
                            <span class="required-mark">*</span>
                        @endif
                    </div>

                    {{-- Render based on field type --}}
                    @if($fieldType === 'radio-score')
                        {{-- Radio Score Table (like original form) --}}
                        <table class="radio-score-table">
                            <thead>
                                <tr>
                                    <th style="text-align: left;">Option</th>
                                    @foreach($field['options'] ?? [] as $optKey => $optLabel)
                                        <th class="radio-option">{{ $optLabel }}</th>
                                    @endforeach
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>{{ $fieldLabel }}</td>
                                    @foreach($field['options'] ?? [] as $optKey => $optLabel)
                                        <td class="radio-option {{ $fieldValue == $optKey ? 'selected-option' : '' }}">
                                            {{ $fieldValue == $optKey ? '●' : '' }}
                                        </td>
                                    @endforeach
                                </tr>
                            </tbody>
                        </table>

                    @elseif($fieldType === 'radio')
                        {{-- Regular Radio --}}
                        <div class="answer-text">
                            @if($fieldValue)
                                @php
                                    $selectedLabel = $field['options'][$fieldValue] ?? $fieldValue;
                                @endphp
                                <strong>{{ $selectedLabel }}</strong>
                            @else
                                <span class="empty-value">Not answered</span>
                            @endif
                        </div>

                    @elseif($fieldType === 'checkbox-group')
                        {{-- Checkbox Group --}}
                        <div class="checkbox-group">
                            @foreach($field['options'] ?? [] as $optKey => $optLabel)
                                @php
                                    $isChecked = false;
                                    if(is_array($fieldValue)) {
                                        $isChecked = in_array($optKey, $fieldValue) || !empty($fieldValue[$optKey]);
                                    }
                                @endphp
                                <div class="checkbox-item">
                                    <span class="checkbox-mark {{ $isChecked ? 'checked' : '' }}"></span>
                                    {{ $optLabel }}
                                </div>
                            @endforeach
                        </div>

                    @elseif($fieldType === 'textarea')
                        {{-- Textarea --}}
                        <div class="textarea-response">
                            @if($fieldValue)
                                {{ $fieldValue }}
                            @else
                                <span class="empty-value">No response provided</span>
                            @endif
                        </div>

                    @else
                        {{-- Text, Email, Date, Number, etc. --}}
                        <div class="answer-text">
                            @if($fieldValue)
                                {{ $fieldValue }}
                            @else
                                <span class="empty-value">Not provided</span>
                            @endif
                        </div>
                    @endif

                </div>
            @endforeach
        @endif
    @endforeach

    {{-- Score Summary --}}
    @if(!empty($scores) && count($scores) > 0)
        <div class="page-break"></div>
        <div class="score-summary avoid-break">
            <h3>Assessment Scores Summary</h3>
            <table class="score-table">
                <thead>
                    <tr>
                        <th style="width: 70%;">Section</th>
                        <th style="width: 30%;">Score</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach($scores as $section => $score)
                        <tr>
                            <td>{{ ucfirst(str_replace('_', ' ', $section)) }}</td>
                            <td class="score-value">{{ $score }}</td>
                        </tr>
                    @endforeach
                    <tr class="total-score-row">
                        <td><strong>TOTAL SCORE</strong></td>
                        <td class="score-value">{{ array_sum($scores) }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    @endif

    {{-- Footer --}}
    <div class="pdf-footer">
        Copyright © {{ date('Y') }} – NeuroFit Connections, LLC | Generated: {{ now()->format('M d, Y') }}
    </div>

</body>
</html>